<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home | Blogify</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    /* ----------  DESIGN TOKENS  ---------- */
    :root{
      --bg:#0f0f11;
      --surface:rgba(255,255,255,.05);
      --surface-up:rgba(255,255,255,.08);
      --border:rgba(255,255,255,.12);
      --text:#ffffff;
      --text-soft:#b3b3b3;
      --accent:#00d2ff;
      --accent-alt:#ff0050;
      --radius:16px;
      --shadow:0 8px 32px rgba(0,0,0,.4);
      --ease:cubic-bezier(.4,0,.2,1);
    }
    *{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI",system-ui,sans-serif}
    body{background:linear-gradient(135deg,#0f0f11 0%, #1a1a2e 100%);color:var(--text);min-height:100vh;line-height:1.6}

    /* ----------  HEADER  ---------- */
    header{position:sticky;top:0;backdrop-filter:blur(12px);background:var(--surface);border-bottom:1px solid var(--border);z-index:10}
    nav{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:.75rem 1rem}
    nav a.logo{font-size:1.5rem;font-weight:700;color:var(--accent);text-decoration:none;display:flex;align-items:center;gap:.5rem}
    nav ul{display:flex;gap:1.5rem;list-style:none}
    nav a{color:var(--text-soft);text-decoration:none;font-size:.9rem;transition:color .2s var(--ease)}
    nav a:hover{color:var(--accent)}
    .dropdown-toggle img{width:28px;height:28px;border-radius:50%;object-fit:cover}
    .dropdown-menu{position:absolute;right:1rem;top:60px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:.5rem 0;display:none;flex-direction:column;min-width:160px}
    .dropdown-menu a{padding:.6rem 1rem;display:flex;align-items:center;gap:.5rem;color:var(--text-soft)}
    .dropdown-menu a:hover{background:var(--surface-up)}
    .dropdown:hover .dropdown-menu{display:flex}

    /* ----------  MAIN  ---------- */
    .main{max-width:1200px;margin:0 auto;padding:2rem 1rem 4rem;display:grid;gap:2rem}
    h1{display:flex;align-items:center;gap:.5rem;font-weight:600;margin-bottom:1rem}

    /* ----------  CARDS  ---------- */
    .card{
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:1.5rem;
      display:grid;
      gap:1rem;
      transition:transform .3s var(--ease), box-shadow .3s var(--ease);
      box-shadow:var(--shadow);
      animation:pop .5s var(--ease) backwards;
    }
    .card:nth-child(2){animation-delay:.05s}
    .card:nth-child(3){animation-delay:.1s}
    .card:nth-child(4){animation-delay:.15s}
    @keyframes pop{from{opacity:0;transform:scale(.96)}to{opacity:1;transform:scale(1)}}
    .card:hover{transform:translateY(-4px);box-shadow:0 12px 48px rgba(0,0,0,.6)}
    .card img{
      width:100%;height:220px;object-fit:cover;border-radius:var(--radius);
      transition:transform .4s var(--ease);
    }
    .card:hover img{transform:scale(1.05)}
    .card h2 a{
      color:var(--text);text-decoration:none;font-size:1.35rem;font-weight:600;
      background:linear-gradient(90deg,var(--accent),var(--accent-alt)) no-repeat left bottom/0 2px;
      transition:background-size .3s var(--ease);
    }
    .card:hover h2 a{background-size:100% 2px}
    .meta{font-size:.85rem;color:var(--text-soft)}
    .meta a{color:var(--accent)}

    /* ----------  ACTIONS  ---------- */
    .actions{display:flex;gap:.75rem;flex-wrap:wrap}
    .btn{
      padding:.55rem 1.1rem;border-radius:999px;border:none;
      font-size:.85rem;display:flex;align-items:center;gap:.4rem;
      cursor:pointer;transition:transform .2s var(--ease),background .2s var(--ease);
      color:#fff;font-weight:600
    }
    .btn:active{transform:scale(.94)}
    .btn.like{background:var(--accent)}
    .btn.like.liked{background:var(--accent-alt)}
    .btn.follow{background:var(--success-color)}
    .btn.follow.following{background:var(--accent-alt)}
    .btn.view{background:var(--surface-up);border:1px solid var(--border)}
    .btn.view:hover{background:var(--surface)}

    /* ----------  COMMENTS  ---------- */
    .comments{margin-top:1rem;padding-top:1rem;border-top:1px solid var(--border)}
    .comment{display:flex;gap:.75rem;margin-bottom:.75rem}
    .comment img{width:32px;height:32px;border-radius:50%}
    .comment-body{background:var(--surface-up);padding:.75rem;border-radius:var(--radius);flex:1}
    .comment-body strong{font-size:.9rem}
    .comment-body span{font-size:.8rem;color:var(--text-soft)}

    /* ----------  RESPONSIVE  ---------- */
    @media(max-width:600px){
      .main{padding:1rem}
      .card{padding:1rem}
    }
  </style>
</head>
<body>
  <%- include('partials/header', { user }) %>

  <main class="main">
    <h1><i class="fas fa-fire"></i> Latest Blogs</h1>

    <% if (success_msg) { %>
      <p class="alert" style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:1rem;font-size:.9rem">
        <i class="fas fa-check-circle" style="color:var(--accent)"></i> <%= success_msg %>
      </p>
    <% } %>

    <% if (error_msg) { %>
      <p class="alert" style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:1rem;font-size:.9rem;color:var(--accent-alt)">
        <i class="fas fa-exclamation-circle"></i> <%= error_msg %>
      </p>
    <% } %>

    <% blogs.forEach(blog => { %>
      <article class="card">
        <% if (blog.coverImage) { %>
          <img src="<%= blog.coverImage %>" alt="cover">
        <% } %>

        <h2><a href="/blog/<%= blog._id %>"><%= blog.title %></a></h2>
        <p style="color:var(--text-soft);font-size:.95rem"><%= blog.body.substring(0,180) %>â€¦</p>

        <div class="meta">
          <i class="fas fa-user"></i>
          <a href="/profile/<%= blog.createdBy._id %>"><%= blog.createdBy.fullname %></a>
          <i class="fas fa-clock" style="margin-left:.75rem"></i> <%= moment(blog.createdAt).fromNow() %>
        </div>

        <div class="actions">
          <% if (user) { %>
            <form action="/blog/<%= blog._id %>/like" method="POST">
              <button class="btn like <%= blog.likes.includes(user._id) ? 'liked' : '' %>">
                <i class="fas <%= blog.likes.includes(user._id) ? 'fa-heart' : 'fa-heart-broken' %>"></i>
                <%= blog.likes.includes(user._id) ? 'Liked' : 'Like' %> (<%= blog.likes.length %>)
              </button>
            </form>

            <form action="<%= blog.isFollowing ? '/user/unfollow/' : '/user/follow/' %><%= blog.createdBy._id %>" method="POST">
              <button class="btn follow <%= blog.isFollowing ? 'following' : '' %>">
                <i class="fas <%= blog.isFollowing ? 'fa-user-minus' : 'fa-user-plus' %>"></i>
                <%= blog.isFollowing ? 'Following' : 'Follow' %>
              </button>
            </form>
          <% } %>

          <a class="btn view" href="/blog/<%= blog._id %>">
            <i class="fas fa-eye"></i> View Post
          </a>
        </div>

        <section class="comments">
          <% blog.comments.forEach(c => { %>
            <div class="comment">
              <img src="<%= c.createdBy.profileImageURL %>" alt="avatar">
              <div class="comment-body">
                <strong><%= c.createdBy.fullname %></strong>
                <div><%= c.content %></div>
                <span><%= moment(c.createdAt).fromNow() %></span>
              </div>
            </div>
          <% }) %>
        </section>
      </article>
    <% }) %>
  </main>
</body>
</html>
